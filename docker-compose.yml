version: '3'

services:
    api-dummy-fpm:
        build:
            context: ./api-dummy
        volumes:
            - ./api-dummy:/srv/app
            - /public/bundles
            - /srv/app/var
            - /srv/app/vendor
        environment:
            - APP_ENV=dev
            - APP_SECRET=f6a87c2e031ecadc0d7eb442729435c5
    api-dummy-nginx:
        image: nginx:1.13
        ports:
            - '8081:80'
        volumes:
            - ./api-dummy/.docker/nginx-server.conf:/etc/nginx/conf.d/default.conf
            - ./api-dummy/public:/srv/app/public
        depends_on:
            - api-dummy-fpm
    dashboard-fpm:
        build:
            context: ./dashboard
        volumes:
            - ./dashboard:/srv/app
            - /srv/app/public/bundles
            - /srv/app/var
            - /srv/app/vendor
        environment:
            - APP_ENV=dev
            - APP_SECRET=f6a87c2e031ecadc0d7eb442729435c7
        depends_on:
            - api-dummy-nginx
    dashboard-nginx:
        image: nginx:1.13
        ports:
            - '8082:80'
        volumes:
            - ./dashboard/.docker/nginx-server.conf:/etc/nginx/conf.d/default.conf
            - ./dashboard/public:/srv/app/public
        depends_on:
            - dashboard-fpm
    journal-fpm:
        build:
            context: ./journal
        volumes:
            - ./journal:/srv/app
            - /public/bundles
            - /srv/app/var
            - /srv/app/vendor
        environment:
            - APP_ENV=dev
            - APP_LIBERO_API=http://api-dummy-nginx
            - APP_SECRET=f6a87c2e031ecadc0d7eb442729435c6
        depends_on:
            - api-dummy-nginx
    journal-nginx:
        image: nginx:1.13
        ports:
            - '8080:80'
        volumes:
            - ./journal/.docker/nginx-server.conf:/etc/nginx/conf.d/default.conf
            - ./journal/public:/srv/app/public
        depends_on:
            - journal-fpm
