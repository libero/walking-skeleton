version: '3'

services:
    api-doc:
        image: swaggerapi/swagger-ui:v3.14.1
        ports:
            - '8082:8080'
        volumes:
            - ./articles.yaml:/usr/share/nginx/html/articles.yaml
            - ./errors.yaml:/usr/share/nginx/html/errors.yaml
            - ./openapi.yaml:/usr/share/nginx/html/openapi.yaml
        environment:
            - API_URL=http://localhost:8082/openapi.yaml
    api-dummy-fpm:
        build:
            context: ./api-dummy
        volumes:
            - ./api-dummy:/srv/app
            - /srv/app/public/bundles
            - /srv/app/var
            - /srv/app/vendor
        environment:
            - APP_ENV=dev
            - APP_SECRET=f6a87c2e031ecadc0d7eb442729435c5
    api-dummy-nginx:
        image: nginx:1.13
        ports:
            - '8081:80'
        volumes:
            - ./api-dummy/.docker/nginx-server.conf:/etc/nginx/conf.d/default.conf
            - ./api-dummy/public:/srv/app/public
        depends_on:
            - api-dummy-fpm
    journal-fpm:
        build:
            context: ./journal
        volumes:
            - ./journal:/srv/app
            - /srv/app/public/bundles
            - /srv/app/var
            - /srv/app/vendor
        environment:
            - APP_ENV=dev
            - APP_LIBERO_API=http://api-dummy-nginx
            - APP_SECRET=f6a87c2e031ecadc0d7eb442729435c6
        depends_on:
            - api-dummy-nginx
    journal-nginx:
        image: nginx:1.13
        ports:
            - '8080:80'
        volumes:
            - ./journal/.docker/nginx-server.conf:/etc/nginx/conf.d/default.conf
            - ./journal/public:/srv/app/public
        depends_on:
            - journal-fpm
